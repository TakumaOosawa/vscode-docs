---
ContentId: c77dcce9-4ba9-40ac-8ae5-2df855088090
DateApproved: 12/10/2025
MetaDescription: ワークスペース コンテキストによってチャットがコードベース全体を深く理解し、正確で文脈に沿った回答を提供する仕組みを学びます。
MetaSocialImage: ../images/shared/github-copilot-social.png
---
# チャットをワークスペースのエキスパートにする

チャットは、個々のファイルだけでなくコードベース全体を深く理解していると、はるかに役立つようになります。ワークスペース コンテキストは、AIがプロジェクト全体を検索し、コンポーネント同士のつながりを理解し、実際のコードに基づいた回答を提供できるようにする基盤となる仕組みです。これにより、「認証はどこで処理されていますか?」や「新しいAPIエンドポイントを追加するにはどうすればよいですか?」のような広い質問を投げかけ、特定のコードベースに基づいた正確な回答を得ることができます。

この記事では、ワークスペース コンテキストの仕組み、最適な結果を得るためにワークスペース インデックスを管理する方法、そしてプロンプトで`@workspace`と`#codebase`を使って活用する方法を説明します。

ワークスペース コンテキストの背後にあるインテリジェンスは、プロジェクトの規模や構成に応じて自動的に調整され、小規模な個人プロジェクトでも大規模なエンタープライズのコードベースでも、正確な結果が得られるようにします。

## ワークスペース コンテキストの仕組み

VS Codeは、質問に最も関連性の高いコードを見つけるために、インテリジェントな検索戦略を使用します。単一のアプローチを使うのではなく、プロジェクトの規模や利用可能なリソースに基づいて最適な方法を自動的に選択します。VS Codeは複数の戦略を並列に実行し、その中から最も速く最良の結果を生成するものを選ぶ場合があります。

### コンテキストにはどのソースが使用されますか?

ワークスペース コンテキストは、開発者がVS Codeでコードベースを探索するときに使用するのと同じソースを検索します:

* ワークスペース内のすべての[インデックス可能なファイル](#what-content-is-included-in-the-workspace-index)(ワークスペース インデックス)。ただし、`.gitignore`ファイルで無視されるものを除きます
* ネストされたフォルダーやファイル名を含むディレクトリ構造
* コード シンボルと定義(クラス、関数、変数)
* アクティブ エディターで現在選択されているテキスト、または表示されているテキスト

ワークスペース インデックスはGitHubによってリモートで維持されるか、マシンにローカル保存されます。詳細については、[ワークスペース インデックス](#workspace-index)セクションを参照してください。

> [!IMPORTANT]
> 無視されているファイルを開いている場合、または無視されているファイル内のテキストを選択している場合は、`.gitignore`はバイパスされます。

### 検索戦略

小規模なプロジェクトでは、ワークスペース全体をチャット コンテキストに直接含めることができます。大規模なプロジェクトでは、VS Codeはプロンプトのチャット コンテキストに含める最も関連性の高い情報を見つけるために、さまざまな戦略を使用します。

次の手順は、VS Codeがワークスペース コンテキストを構築する方法の概要を示しています:

1. 質問に答えるためにワークスペースからどの情報が必要かを判断し、会話履歴、ワークスペース構造、現在のエディターの選択内容も含めます。

1. さまざまな方法を使用して、[ワークスペース インデックス](#workspace-index)から関連するコード スニペットを収集します:

    * [GitHubのコード検索](https://github.blog/2023-02-06-the-technology-behind-githubs-new-code-search)
    * 厳密なキーワード一致だけでなく、質問の意味に一致するコードを見つけるためのローカルのセマンティック検索
    * テキストベースのファイル名と内容の検索
    * 関数シグネチャ、パラメーターなどの詳細を追加するためのVS Codeの言語IntelliSense

1. 生成されたコンテキストが_コンテキスト ウィンドウ_に収まらないほど大きい場合は、最も関連性の高い部分のみが保持されます。

## ワークスペース インデックス

VS Codeのチャットは、関連するコード スニペットをコードベースからすばやく正確に検索するためにインデックスを使用します。このインデックスはGitHubによって維持されるか、マシンにローカル保存されます。

リモート インデックスは、GitHubまたはAzure DevOps上のリポジトリのコミット済みの状態から構築されます。これは、ローカル ワークスペース内の未コミットの変更はリモート インデックスに含まれないことを意味します。

ローカルに未コミットの変更がある場合、VS Codeはリモート インデックスとローカル ファイル トラッキングを組み合わせたハイブリッド アプローチを使用します。VS Codeは、インデックス化されたコミット以降に変更されたファイルを検出し、リアルタイムの内容としてエディターから現在のファイル内容も読み取ります。

使用されているインデックスの種類とそのインデックス作成状態は、VS Codeのステータス バーにあるCopilotステータス ダッシュボードで確認できます。

![Screenshot showing the workspace index status in the Copilot status menu.](../images/workspace-context/workspace-index-status.png)

### リモート インデックス

VS Codeは、リモートのコード検索インデックスを使用して、大規模なコードベースでもAIがコードベースをすばやく検索できるようにします。リモートのコード検索は現在、GitHubまたはAzure DevOpsリポジトリを使用するワークスペースで利用できます。

#### GitHubのリモート インデックス作成

VS Codeは、ワークスペース内のGitHubで管理されているリポジトリについて、リモートのコード検索インデックスを自動的に構築して使用します。VS CodeでGitHubアカウントにサインインすると、チャットは利用可能なリモートのコード検索インデックスを自動的に使用し始めます。

リポジトリは、チャットで初めて`@workspace`または`#codebase`が使用されたときに自動的にインデックス化されます。コマンド パレット(`kb(workbench.action.showCommands)`)で**Build Remote Workspace Index**コマンドを実行して、インデックス作成を強制することもできます。

インデックスはリポジトリごとに一度だけ構築すれば十分です。その後はインデックスが自動的に最新の状態に保たれます。インデックスの構築は小規模および中規模のプロジェクトでは高速ですが、リポジトリに数十万のファイルが含まれている場合は少し時間がかかることがあります。また、GitHubに比較的新しいバージョンのコードがある場合にリモート インデックスは最適に機能するため、コードは定期的にGitHubへプッシュしてください。

現在、リモート インデックス作成はGitHub.comまたはGitHub Enterprise CloudでホストされているGitHubリポジトリで動作します。GitHub Enterprise Serverを使用するリポジトリではサポートされていません。

#### Azure DevOpsのリモート インデックス作成

VS Codeは、Azure DevOpsリポジトリでもリモート インデックスを使用できます。これらのインデックスは自動的に構築され、維持されます。VS CodeでMicrosoftアカウントにサインインすると、チャットがリモート インデックスの使用を開始します。現在のインデックス状態を確認したり、アカウントにAzure DevOpsリポジトリへアクセスするための適切な権限がない場合にサインイン リンクを取得したりするには、Copilotステータス バー項目を確認してください。

### ローカル インデックス

[リモート インデックス](#remote-index)を使用できない場合(たとえばGitHubまたはAzure DevOpsリポジトリを使用していない場合)、VS Codeはローカル マシンに保存された高度なセマンティック インデックスを使用して、高速で高品質な検索結果を提供できます。現在、ローカル インデックスはインデックス可能なファイルが2500個までに制限されています。

ローカル インデックスを構築するには:

* プロジェクトにインデックス可能なファイルが750個未満ある場合: VS Codeは高度なローカル インデックスを自動的に構築します。

* プロジェクトにインデックス可能なファイルが750～2500個ある場合: コマンド パレット(`kb(workbench.action.showCommands)`)で**Build local workspace index**コマンドを実行します。これは一度だけ実行すれば十分です。

* プロジェクトにインデックス可能なファイルが2500個を超える場合: [基本インデックス](#basic-index)を使用します。

最初のローカル インデックスを構築したり、たとえばgitブランチの切り替えなどで多くのファイルが変更された場合にインデックスを更新したりするには、時間がかかることがあります。現在のローカル インデックスの状態は、ステータス バーのCopilotステータス ダッシュボードで監視できます。

### 基本インデックス

プロジェクトに[リモート インデックス](#remote-index)がなく、[インデックス可能なファイル](#what-content-is-included-in-the-workspace-index)が2500個を超える場合、VS Codeはコードベースの検索に基本インデックスを使用するようフォールバックします。このインデックスはよりシンプルなアルゴリズムを使用してコードベースを検索し、大規模なコードベースでローカルに動作するよう最適化されています。

基本インデックスは多くの種類のチャット プロンプトで十分に機能するはずです。ただし、チャットがコードベースに関する質問に対して関連性の高い回答を提供するのに苦労していると感じる場合は、[リモート インデックス](#remote-index)へのアップグレードを検討してください。

### ワークスペース インデックスに含まれる内容

VS Codeは、現在のプロジェクトの一部である関連するテキスト ファイルをインデックス化します。これは特定のファイルの種類やプログラミング言語に限定されませんが、VS Codeは`.tmp`や`.out`ファイルなど、ワークスペースに関する質問には通常関連しない一般的なファイルの種類を自動的にスキップします。

ワークスペース インデックスは、`setting(files.exclude)`設定でVS Codeから除外されているファイルや、`.gitignore`ファイルに含まれるファイルも除外します。

また、VS Codeは現在、画像やPDFなどのバイナリ ファイルはインデックス化しません。

## チャットでワークスペース コンテキストを使用する

チャットでワークスペースに関する質問をする場合、ワークスペース コンテキストを判定する動作は、使用しているエージェントによって異なります:

* **Agent/Plan**

    エージェントを使用している場合、エージェントはプロンプトに基づいて自動的に_エージェント的_なコードベース検索を実行します。これは、ワークスペース コンテキストを判定するための最初の検索を行った後、結果に応じて、質問に答えるために必要な情報を収集するための追加の、より的を絞った検索を実行することをエージェントが決定する可能性があることを意味します。

    プロンプトで`#codebase`ツールを明示的に参照する必要はありませんが、質問でワークスペース コンテキストが使用されることを確実にしたい場合は参照できます。これは、プロンプトが曖昧で、ワークスペース コンテキストを必要としないものとして解釈される可能性がある場合に役立ちます。

* **Ask/Edit**

    AskまたはEditでは、VS Codeはプロンプトに対して意図検出を行い、ワークスペース コンテキストが必要かどうかを判断します。ワークスペース コンテキストが必要な場合、VS Codeはコードベース検索を実行し、関連するコード スニペットをチャット コンテキストに追加します。エージェントの使用とは異なり、フォローアップ検索は実行されません。

    プロンプトで`#codebase`ツールを明示的に参照する必要はありませんが、質問でワークスペース コンテキストが使用されることを確実にしたい場合は参照できます。これは、プロンプトが曖昧で、ワークスペース コンテキストを必要としないものとして解釈される可能性がある場合に役立ちます。

## ワークスペース コンテキストを使用するためのヒント

質問の言い回しは、コンテキストの品質と回答の正確性に大きく影響します。結果を最適化するために、次のヒントを検討してください:

* 質問は具体的かつ詳細にし、「これは何をしますか」のような曖昧な表現は避けてください。この場合の「これ」は、直前の回答、現在のファイル、またはプロジェクト全体として解釈される可能性があります。
* コードやそのドキュメントに出現しそうな用語や概念をプロンプトに取り入れてください。
* コードを選択したり、ファイルを参照したり、デバッグ コンテキスト、ターミナル出力などのコンテキスト項目を[#-メンション](/docs/copilot/chat/copilot-chat-context.md)したりして、関連するコンテキストを明示的に含めてください。
* 回答は、「catchブロックのない例外を見つける」や「handleErrorが呼び出される方法の例を示す」のように、複数の参照から導かれることがあります。ただし、「この関数は何回呼び出されていますか?」や「このプロジェクトのすべてのバグを修正してください」のような、コードベース全体にわたる包括的なコード解析を期待しないでください。
* 「このファイルに誰が貢献しましたか?」や「このフォルダーのレビュー コメントを要約してください」のように、コード以外の情報を尋ねる場合は、エージェントを使用するときに関連する[ツールまたはMCPサーバー](/docs/copilot/chat/chat-tools.md)を構成してください。

## プライベート リポジトリ

プライベート リポジトリでより多くのワークスペース検索機能を有効にするには、追加のアクセス許可が必要です。これらのアクセス許可がまだないことが検出された場合、起動時に要求します。許可されると、今後のためにセッションを安全に保存します。

![Modal window asking for additional authentication for a private repository.](../images/workspace-context/authentication.png)

セキュリティ、プライバシー、透明性の詳細については、[GitHub Copilot Trust Center](https://resources.github.com/copilot-trust-center/)を参照してください。

## よく寄せられる質問

### `@workspace`と`#codebase`の違いは何ですか?

概念的には、`@workspace`と`#codebase`のどちらもコードベース全体に関する質問をできるようにします。ただし、使い方にはいくつかの違いがあります:

* `@workspace`は[チャット参加者](/docs/copilot/chat/copilot-chat-context.md#atmentions)です

    `@workspace`参加者は、コードベースに関する質問に答えることに特化した分野の専門家です。言語モデルはチャット プロンプト全体を参加者に引き渡し、参加者はコードベースに関する知識を使って回答を提供します。チャット参加者を使用しているとき、言語モデルは追加の処理を実行したり、他のツールを呼び出したりできません。チャット プロンプトに含められるチャット参加者は1つだけです。

* `#codebase`は[チャット ツール](/docs/copilot/chat/chat-tools)です

    `#codebase`ツールは、コードベースから関連情報を検索することに特化しています。これは、チャット プロンプトに答えるときに言語モデルが呼び出すことを選択できる多数のツールの1つです。言語モデルは、質問に答えるために必要な情報を収集するために、他のツールと織り交ぜながら`#codebase`ツールを複数回呼び出すことを決定できます。チャット プロンプトには複数のツールを含めることができます。

柔軟性が高いため、チャット プロンプトでは`#codebase`を使用することをおすすめします。
