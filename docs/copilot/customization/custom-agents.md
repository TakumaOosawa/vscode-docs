---
ContentId: 276ecd8f-2a76-467e-bf82-846d49c13ab5
DateApproved: 12/10/2025
MetaDescription: VS CodeでAIチャットの動作を特定のワークフローや開発シナリオに合わせて調整するためのカスタムエージェント(旧:カスタムチャットモード)の作成方法を学びます。
MetaSocialImage: ../images/shared/github-copilot-social.png
---
# VS Codeのカスタムエージェント

カスタムエージェントを使うと、特定の開発ロールやタスクに合わせた異なるペルソナをAIに採用させるように構成できます。たとえば、セキュリティレビュアー、プランナー、ソリューションアーキテクトなど、ほかの専門ロール向けのエージェントを作成できます。各ペルソナには、独自の動作、使用できるツール、指示を設定できます。

また、handoffsを使ってエージェント間のガイド付きワークフローを作成し、1回のクリックである専門エージェントから別の専門エージェントへシームレスに移行できます。たとえば、プランニングエージェントから実装エージェントへ直接移動したり、関連するコンテキストを含めてコードレビュアーへ引き継いだりできます。

この記事では、VS Codeでカスタムエージェントを作成および管理する方法を説明します。

> [!NOTE]
> カスタムエージェントはVS Codeリリース1.106以降で利用できます。カスタムエージェントは以前はカスタムチャットモードと呼ばれていました。

## カスタムエージェントとは

[組み込みエージェント](/docs/copilot/chat/copilot-chat.md#switch-between-agents)は、VS Codeでのチャット向けに汎用的な構成を提供します。より用途に合わせたチャット体験にするために、独自のカスタムエージェントを作成できます。

カスタムエージェントは、そのエージェントに切り替えたときに適用される指示とツールのセットで構成されます。たとえば、「Plan」エージェントには実装計画を生成するための指示を含め、読み取り専用ツールのみを使用するようにできます。カスタムエージェントを作成すると、毎回関連するツールや指示を手動で選択しなくても、その特定の構成にすばやく切り替えられます。

カスタムエージェントは`.agent.md`のMarkdownファイルで定義し、他のユーザーが使えるようにワークスペースに保存することも、ユーザープロファイルに保存して複数のワークスペースで再利用することもできます。

カスタムエージェントは[バックグラウンドエージェント](/docs/copilot/agents/background-agents.md)や[クラウドエージェント](/docs/copilot/agents/cloud-agents.md)でも再利用でき、同じ専門的な構成で自律タスクを実行できます。

## カスタムエージェントを使用する理由

タスクによって必要な機能は異なります。プランニングエージェントは、誤ったコード変更を防ぐために調査と分析に読み取り専用ツールだけが必要な場合があります。一方で、実装エージェントには完全な編集機能が必要です。カスタムエージェントを使うと、各タスクで使用できるツールを正確に指定でき、AIが作業に適した機能を確実に持てるようにできます。

カスタムエージェントでは、AIの動作方法を定義する専門的な指示も提供できます。たとえば、プランニングエージェントではプロジェクトのコンテキストを収集して詳細な実装計画を生成するようにAIに指示できます。一方で、コードレビューエージェントではセキュリティ脆弱性の特定と改善提案に重点を置けます。こうした専門的な指示により、そのエージェントに切り替えるたびに、一貫したタスクに適した応答が得られます。

> [!NOTE]
> サブエージェントはカスタムエージェントとともに実行できます。[カスタムエージェントでサブエージェントを実行する](/docs/copilot/chat/chat-sessions.md#use-a-custom-agent-with-subagents-experimental)方法の詳細を確認してください(実験的機能)。

## Handoffs

handoffsを使うと、推奨される次の手順とともにエージェント間を移行する、ガイド付きの順次ワークフローを作成できます。チャット応答が完了すると、handoffボタンが表示され、関連するコンテキストと事前入力されたプロンプトを持って次のエージェントへ移動できます。

handoffsは、次のステップへ進む前に各ステップをレビューして承認できるようにし、開発者のコントロールを維持しながら複数ステップのワークフローを編成するのに役立ちます。例:

* **プランニング → 実装**: プランニングエージェントで計画を生成し、その後、実装エージェントに引き継いでコーディングを開始します。
* **実装 → レビュー**: 実装を完了し、その後、コードレビューエージェントに切り替えて品質とセキュリティの問題を確認します。
* **失敗するテストを書く → 成功するテストを書く**: 大規模な実装よりレビューしやすい失敗するテストを生成し、その後、必要なコード変更を実装してテストを成功させるために引き継ぎます。

エージェントファイルでhandoffsを定義するには、フロントマターに追加します。各handoffでは、ターゲットエージェント、ボタンラベル、送信する任意のプロンプトを指定します。

```markdown
---
description: 実装計画を生成する
tools: ['search', 'fetch']
handoffs:
  - label: 実装を開始
    agent: implementation
    prompt: それでは、上で示した計画を実装してください。
    send: false
---
```

ユーザーがhandoffボタンを見て選択すると、プロンプトが事前入力された状態でターゲットエージェントに切り替わります。`send: true`の場合、次のワークフローステップを開始するためにプロンプトが自動的に送信されます。

## カスタムエージェントファイルの構造

カスタムエージェントファイルはMarkdownファイルで、拡張子として`.agent.md`を使用し、次の構造になります。

> [!NOTE]
> VS Codeは、ワークスペースの`.github/agents`フォルダーにある任意の`.md`ファイルをカスタムエージェントとして検出します。

### ヘッダー(任意)

ヘッダーはYAMLフロントマターとして書式設定され、次のフィールドがあります。

| Field | Description |
| --- | --- |
| `description`     | カスタムエージェントの簡単な説明。チャット入力フィールドのプレースホルダーテキストとして表示されます。 |
| `name`            | カスタムエージェントの名前。指定しない場合はファイル名が使用されます。 |
| `argument-hint`   | 任意。カスタムエージェントとの対話方法をユーザーに案内するために、チャット入力フィールドに表示されるヒントテキストです。 |
| `tools`           | このカスタムエージェントで使用できるツール名またはツールセット名の一覧。組み込みツール、ツールセット、MCPツール、拡張機能が提供するツールを含められます。MCPサーバーのすべてのツールを含めるには、`<server name>/*`形式を使用します。<br/>詳細は[チャットのツール](/docs/copilot/chat/chat-tools.md)を参照してください。 |
| `model`           | プロンプト実行時に使用するAIモデル。指定しない場合は、モデルピッカーで現在選択されているモデルが使用されます。 |
| `infer`           | 任意。カスタムエージェントを[サブエージェント](/docs/copilot/chat/chat-sessions.md#context-isolated-subagents)として使用できるようにするブールフラグ(既定は`true`)。 |
| `target`          | カスタムエージェントのターゲット環境またはコンテキスト(`vscode`または`github-copilot`)。 |
| `mcp-servers`     | 任意。[GitHub Copilotのカスタムエージェント](https://docs.github.com/en/copilot/how-tos/use-copilot-agents/coding-agent/create-custom-agents)で使用するModel Context Protocol (MCP)サーバー構成jsonの一覧(target: `github-copilot`)。 |
| `handoffs`        | 任意。カスタムエージェント間を遷移するための推奨される次のアクションまたはプロンプトの一覧。handoffボタンはチャット応答の完了後に対話型の提案として表示されます。 |
| `handoffs.label`  | handoffボタンに表示されるテキスト。 |
| `handoffs.agent`  | 切り替え先のターゲットエージェント識別子。 |
| `handoffs.prompt` | ターゲットエージェントに送信するプロンプトテキスト。 |
| `handoffs.send`   | 任意。プロンプトを自動送信するブールフラグ(既定は`false`) |

> [!NOTE]
> 指定したツールがカスタムエージェント使用時に利用できない場合、そのツールは無視されます。

### 本文

カスタムエージェントファイルの本文には、Markdown形式でカスタムエージェントの実装を記述します。ここで、このカスタムエージェント使用時にAIに従わせたい具体的なプロンプト、ガイドライン、その他の関連情報を提供します。

Markdownリンクを使って他のファイルを参照できます(たとえば、指示ファイルを再利用する場合など)。

本文テキスト内でエージェントツールを参照するには、`#tool:<tool-name>`構文を使用します。たとえば、`githubRepo`ツールを参照するには`#tool:githubRepo`を使用します。

チャットビューでカスタムエージェントを選択すると、カスタムエージェントファイル本文のガイドラインがユーザーのチャットプロンプトの先頭に付加されます。

### カスタムエージェントの例

次のコードスニペットは、実装計画を生成し、コード編集を一切行わない「Plan」カスタムエージェントファイルの例を示しています。コミュニティが提供する例については、[Awesome Copilotリポジトリ](https://github.com/github/awesome-copilot/tree/main)を参照してください。

```markdown
---
description: 新機能の追加や既存コードのリファクタリングのための実装計画を生成します。
name: プランナー
tools: ['fetch', 'githubRepo', 'search', 'usages']
model: Claude Sonnet 4
handoffs:
  - label: 計画を実装
    agent: agent
    prompt: 上で示した計画を実装してください。
    send: false
---
# プランニングの指示
あなたはプランニングモードです。あなたのタスクは、新機能のため、または既存コードのリファクタリングのための実装計画を生成することです。
コードの編集は行わず、計画のみを生成してください。

計画は実装計画を記述するMarkdownドキュメントで、次のセクションを含みます。

* 概要: 機能またはリファクタリングタスクの簡単な説明。
* 要件: 機能またはリファクタリングタスクの要件一覧。
* 実装手順: 機能またはリファクタリングタスクを実装するための詳細な手順一覧。
* テスト: 機能またはリファクタリングタスクを検証するために実装が必要なテスト一覧。
```

## カスタムエージェントを作成する

ワークスペースまたはユーザープロファイルにカスタムエージェントファイルを作成できます。

1. エージェントドロップダウンから**Configure Custom Agents**を選択し、**Create new custom agent**を選択するか、コマンドパレット(`kb(workbench.action.showCommands)`)で**Chat: New Custom Agent**コマンドを実行します。

1. カスタムエージェントファイルを作成する場所を選択します。

    * **Workspace**: ワークスペース内でのみ使用するために、ワークスペースの`.github/agents`フォルダーにカスタムエージェント定義ファイルを作成します。

    * **User profile**: すべてのワークスペースで使用するために、[現在のプロファイルフォルダー](/docs/configure/profiles.md)にカスタムエージェント定義ファイルを作成します。

1. カスタムエージェントのファイル名を入力します。これがエージェントドロップダウンに表示される既定の名前になります。

1. 新しく作成した`.agent.md`ファイルにカスタムエージェントの詳細を記述します。

    * ファイル先頭のYAMLフロントマターを記入して、カスタムエージェントの名前、説明、ツール、その他の設定を構成します。
    * ファイル本文にカスタムエージェント向けの指示を追加します。

カスタムエージェント定義ファイルを更新するには、エージェントドロップダウンから**Configure Custom Agents**を選択し、一覧からカスタムエージェントを選択して変更します。

> [!NOTE]
> 以前にワークスペースの`.github/chatmodes`フォルダーで拡張子`.chatmode.md`のカスタムチャットモードを作成している場合でも、VS Codeはそれらのファイルをカスタムエージェントとして認識します。クイックフィックスアクションを使用して、それらを`.agent.md`拡張子の新しい`.github/agents`フォルダーへリネームして移動できます。

## エージェントドロップダウンリストをカスタマイズする

複数のカスタムエージェントがある場合、エージェントドロップダウンに表示するものをカスタマイズできます。特定のカスタムエージェントを表示/非表示にするには、次の手順に従います。

1. エージェントドロップダウンから**Configure Custom Agents**を選択します。

1. 一覧のカスタムエージェントにマウスカーソルを合わせ、目のアイコンを選択して、エージェントドロップダウンでの表示/非表示を切り替えます。

## ツールリストの優先順位

`tools`メタデータフィールドを使用して、カスタムエージェントとプロンプトファイルの両方で利用可能なツール一覧を指定できます。プロンプトファイルは`agent`メタデータフィールドを使用してカスタムエージェントを参照することもできます。

チャットで利用可能なツール一覧は、次の優先順位で決まります。

1. プロンプトファイルで指定されたツール(存在する場合)
2. プロンプトファイルで参照されたカスタムエージェントのツール(存在する場合)
3. 選択したエージェントの既定ツール(存在する場合)

## チーム間でカスタムエージェントを共有する(実験的機能)

チーム内でカスタムエージェントを共有するには、ワークスペースレベルのカスタムエージェント(`.github/agents`フォルダー)を作成できます。組織内の複数のワークスペースでカスタムエージェントを共有したい場合は、GitHub Organizationレベルで定義できます。

VS Codeは、アカウントがアクセスできるOrganizationレベルで定義されたカスタムエージェントを自動的に検出します。これらのエージェントは、チャットのAgentsドロップダウンで、組み込みエージェント、および個人/ワークスペースのカスタムエージェントと並んで表示されます。

Organizationレベルのカスタムエージェントの検出を有効にするには、`setting(github.copilot.chat.customAgents.showOrganizationAndEnterpriseAgents)`を`true`に設定します。

GitHubドキュメントで、[組織向けにカスタムエージェントを作成する](https://docs.github.com/en/copilot/how-tos/use-copilot-agents/coding-agent/create-custom-agents)方法を確認してください。

## よくある質問

### カスタムエージェントはチャットモードと異なりますか?

カスタムエージェントは以前はカスタムチャットモードと呼ばれていました。機能は同じですが、特定のタスクに合わせてAIの動作をカスタマイズする目的をより適切に表すために用語が更新されました。

VS Codeは既存の`.chatmode.md`ファイルも引き続きカスタムエージェントとして認識します。クイックフィックスアクションを使用して、それらを`.agent.md`拡張子の新しい`.github/agents`フォルダーへリネームして移動できます。

## 関連リソース

* [Customize AI with custom instructions](/docs/copilot/customization/custom-instructions.md)
* [Create reusable prompt files](/docs/copilot/customization/prompt-files.md)
* [Use tools in chat](/docs/copilot/chat/chat-tools.md)
